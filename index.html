<!DOCTYPE html>
<html>
	<head>

		<title>Global Ecodash</title>
		<link rel="icon" href="https://cdn.pixabay.com/photo/2016/03/31/21/33/cartoon-1296497_1280.png">

		<!-- meta data -->
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="description" content="">
		<meta name="keywords" content="">
		<meta name="author" content="">

		<!-- The Google JavaScript loader tool (for the Maps, Charts APIs). -->
		<script src="https://www.google.com/jsapi"></script>

		<!-- Google Web Fonts. -->
		<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

		<!-- Third-party JavaScript. -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBInHwppL3GVDOj7SEq6Li610cSBc7YJJo&v=3.exp&libraries=drawing&geometry"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.0/js/bootstrap-datepicker.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.1.5/bootstrap-slider.min.js"></script>
		<script src="https://code.highcharts.com/highcharts.js"></script>
		<script src="https://code.highcharts.com/modules/exporting.js"></script>

		<!-- Third-party CSS. -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.0/css/bootstrap-datepicker.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/6.1.5/css/bootstrap-slider.min.css">

		<!-- Load custom JavaScript and stylesheet(s). -->
		<link rel="stylesheet" href="static/main.css">
		<script src="/static/script.js"></script>
		<script src="/static/ee_api_js.js"></script>

	</head>
	<body>

		<!-- The DOM of the application. -->
		<div class="water">

			<!-- Banner with SERVIR-Mekong logo. -->
			<div class="banner" align="right">
				<div style="float:right; width:100%; height: 20px; margin:0px 10px; "><img border="0" style="height:25px; margin-top:2px;" src="static/images/servir.png"></div>
			</div>

			<!-- The element into which Google Maps is rendered. -->
			<div class="map"></div>

			<!-- The UI wrapper. -->
			<div class="ui">

				<!-- Button that opens the main control box after it has been collapsed -->
				<div class="settings-button">&#9776;</div>
				<script>
				$(document).ready(function(){
					$(".settings-button").click(function () {
						$(".settings-button").toggle();
						$(".panel").toggle();
					});
				});
				</script>

				<!-- The main control box. -->
				<div class="panel">

					<!-- Title, info button with general information text and collapse button. -->
					<header>
						<h1>
							<span>Global Ecodash</span>
							<!-- collapse button for entire panel. -->
							<div class="collapse-button">&#171;</div>
							<script>
							$(document).ready(function(){
								$(".collapse-button").click(function () {
									$(".panel").toggle();
									$(".settings-button").toggle();
								});
							});
							</script>
							<!-- button that toggles display of general information -->
							<button class="general-info-button btn btn-default btn-xs pull-right">i</button>
							<script>
							$(".general-info-button").click(function () {
								$(".general-info").toggleClass("general-info-shown");
							});
							</script>
							<!-- Arrow to indicate info button during demo -->
							<div class="demo-arrow-general-info">&#8598;</div>
							<!-- General information panel -->
							<div class="general-info">
								<span>
								<b>Welcome to the SERVIR Global Ecodash</b><br>
								We develop a vegetation monitoring framework based on the BACI (Before-After, Control-Impact) design and cloud based-computing which
								is applicable at a planetary scale. Our approach utilizes Google Earth, a state-of-the-art cloud computing platform. For users,
								a web-based application named EcoDash is developed which maps vegetation using Enhanced Vegetation Index (EVI) from Moderate Resolution
								Imaging Spectroradiometer (MODIS) products from both Terra and Aqua sensors available from 2000 and 2002 respectively. To detect change in
								vegetation we define an EVI anomaly referenced to a baseline period and draw results at a planetary scale using the web-based application
								finding various countries showing improvement or degradation from a user-defined baseline period.
								</span>
								<script>
								$(".demo-button").click(function () {
									if ($(".demo-info").css("display") == "none") {
										$(".demo-info").css("display", "block");
									};
								});
								</script>
							</div>
						</h1>
					</header>

					<!-- The demo -->
					<div class="demo-info">
						<div class="demo-info-text">
							<span>
							<b>This is the Surface Water Tool Demo!</b><br><br>
							<!--Click 'Next' to proceed to the next step or,<br> at any time, click 'Exit' to close.-->
							Sadly, the demo is not implemented yet. Coming soon!
							</span>
						</div>
						<!--<button class="demo-button-next btn btn-default">Next</button>-->
						<button class="demo-button-exit btn btn-default">Exit</button>
					</div>
					<div class="demo-info-clicks">
						<div class="demo-info-click1">
							<span>
							We will first go over some of the basics of the application, before we dive in a little deeper.<br><br>
							All info panels are toggled on/off with their 'i' button.<br>Turn the general information panel off so that we can see a bit more of the map.<br>
							Then, click 'Next' to go to the next step of the demo.
							</span>
						</div>
						<div class="demo-info-click2">
							<span>
							The map shown is a standard Google Maps instance with most of its basic functionality.<br>
							You can zoom in/out with the buttons in the bottom right corner, or with the scroll wheel of your mouse.<br>
							You can toggle different Google Maps displays with the buttons in the top left corner.<br><br>
							The data generated by the algorithm is visualized on top of this map.<br> It displays permanent and temporary water in different shades of blue,<br>
							as shown in the legend.
							</span>
						</div>
						<div class="demo-info-click3">
							<span>
							As a user of this tool, you can specify yourself for which time period you want to visualize the data.<br>This will change the input of the algorithm,
							and make it carry out a new run in Earth Engine.<br>Once finished, the new results will be displayed on the map. Because of this on-the-fly calculation,
							it might take some time for the results to load.<br><br>
							Try it out yourself by changing the time period.
							</span>
						</div>
						<div class="demo-info-click-final">
							<span>Congratulations! You've reached the end of the demo!</span>
						</div>
					</div>
					<script>
					// 'Next' button
					var countClicks = 0;  // initialize click counter
					$(".demo-button-next").click(function () {
						if ($(".demo-info-clicks").css("display") == "none") {
							$(".demo-info-clicks").css("display", "block");
						};
						countClicks ++;
						if (countClicks == 1) {
							$(".demo-info-click-final").hide();
							$(".demo-info-click1").show();
							if ($(".demo-arrow-general-info").css("display") == "none") {
								$(".demo-arrow-general-info").css("display", "inline");
							};
						} else if (countClicks == 2) {
							$(".demo-arrow-general-info").hide();
							$(".demo-info-click1").hide();
							$(".demo-info-click2").show();
							$(".legend-border").css("border-color", "black");
						} else if (countClicks == 3) {
							$(".demo-info-click2").hide();
							$(".legend-border").css("border-color", "white");
							$(".demo-info-click3").show();
						} else {
							$(".demo-info-click3").hide();
							$(".demo-info-click-final").show();
							countClicks = 0;
						};
					});
					// 'Exit' button
					$(".demo-button-exit").click(function () {
						// remove all active demo elements
						$(".demo-info-click1").hide();
						$(".demo-info-click2").hide();
						$(".demo-info-click3").hide();
						$(".demo-info-click-final").hide();
						$(".demo-info-clicks").hide();
						$(".demo-arrow-general-info").hide();
						$(".legend-border").css("border-color", "white");
						$(".demo-info").hide();
						// reset click counter
						countClicks = 0;
					});
					</script>

					<!-- Instructions -->
					<p class="instructions">
						Enter or select a time period to perform a new calculation.<!--<br>Draw up a region to allow data export.--><br> Check out the documentation to learn more about this tool.
					</p>

					<!-- Legend (legend border is only used in the demo) -->
					<div class="legend-border">
						<div class="legend">
							<div class="legend-text">
								<span>Legend:</span>
								<img class="legend-img" src="/static/images/mylegend.png" alt="Legend">
								<p class='legend-labels'>
									Decrease
									&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
									Stable
									&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
									Increase
								</p>
							</div>
						</div>
					</div>

					<!-- Controls -->
					<div class="controls">
						<div class="inputs">
							<p><b>Controls:</b></p>
							<!-- The year selection control. -->
							<div class="input-block before-date">
								<div class="input-block-label"><b>B</b>efore Period:</div>
								<input class="date-picker-1 form-control">
								<span class="period_slice"> - </span>
								<input class="date-picker-2 form-control">
							</div>

							<div class="input-block after-date">
								<div class="input-block-label"><b>A</b>fter Period:</div>
								<input class="date-picker-3 form-control">
								<span class="period_slice"> - </span>
								<input class="date-picker-4 form-control">
							</div>

							<!-- The region selection control. -->
							<div class="input-block control-region">
								<div class="control-input-block-label"><b>C</b>ontrol Region:</div>
								<ul>
									<li><input type="radio" name="control-selection-method" value="Adm. bounds" id="control-selection-method"><label>Adm. bounds</label></li>
									<!-- <li><input type="radio" name="control-selection-method" value="Tiles" id="control-selection-method"><label>Tiles</label></li> -->
									<li><input type="radio" name="control-selection-method" value="Draw polygon" id="control-selection-method"><label>Draw polygon</label></li>
									<li><span class="box" id="controlRegionColorBox" style="background-color: #e8370b" /></li>
								</ul>
								<span class="message">
									<a class="control-draw" href="#"></a>
								</span>
								<span class="message-drawing">
									<!--Draw a polygon... -->
									<!--<button class="control-cancel btn btn-default btn-xs">Cancel</button>-->
								</span>
								<span class="message-selected">
									<!--Selected-->
									<button class="control-clear btn btn-default btn-xs">Clear</button>
								</span>
							</div>

							<div class="input-block intervention-region">
								<div class="intervention-input-block-label"><b>I</b>ntervention Region:</div>
								<ul>
									<li><input type="radio" name="intervention-selection-method" value="Adm. bounds" id="intervention-selection-method"><label>Adm. bounds</label></li>
									<!-- <li><input type="radio" name="intervention-selection-method" value="Tiles" id="intervention-selection-method"><label>Tiles</label></li> -->
									<li><input type="radio" name="intervention-selection-method" value="Draw polygon" id="intervention-selection-method"><label>Draw polygon</label></li>
									<li><span class="box" id="interventionRegionColorBox" style="background-color: #16e5b1" /></li>
								</ul>
								<span class="message">
									<a class="intervention-draw" href="#"></a>
								</span>
								<span class="message-drawing">
									<!--Draw a polygon... -->
									<!--<button class="intervention-cancel btn btn-default btn-xs">Cancel</button>-->
								</span>
								<span class="message-selected">
									<!--Selected-->
									<button class="intervention-clear btn btn-default btn-xs">Clear</button>
								</span>
							</div>

							<div>
								<button class="update btn btn-primary">Update Map</button>
								<br>
							</div>
							<div>
								<button class="submit btn btn-primary">BACI Analysis</button>
								<br>
							</div>

							<!-- The export controls. -->
							<div class="input-block">
								<div class="input-block-label">Export Region:</div>
									<ul>
										<li><input type="radio" name="export-selection" value="control" id="export-selection"><label>Control</label></li>
										<li><input type="radio" name="export-selection" value="intervention" id="export-selection"><label>Intervention</label></li>
									</ul>
								<br>
								<span class="input-block-label">Filename:</span>
								<input type="text" name="filename" class="filename form-control"
									   placeholder="default: Ecodash_BACI_<period>">
								<button class="export btn btn-primary" disabled>Export</button>
								<button class="export-info-button btn btn-default btn-xs">i</button>
								<div class="export-info">
									<span>
									Exporting results is enabled once you have selected a region (or completed drawing a polygon) on the map. This is done by
									first choosing a region selection method above. This will either load a new map layer from which you can select one ore more
									areas, or it will allow you to draw a polygon on the map yourself. Since this accesses the same database as the other map layers
									it is advised to wait for those to load before making a region selection. <br><br>
									You can select multiple areas (up to a maximum of four) by holding down the Ctrl key. Pressing the Esc key will reset the region selection.<br><br>
									Optionally, a filename for the to-be-downloaded data can be entered. If omitted, a default filename will be constructed using the selected time period.<br><br>
									Clicking the Export button reveals a panel on the top right of the screen. Download links will be shown there once they are ready for use. Map (water) layers are
									downloaded as zipped GeoTIFF files (0=no water, 1=temporary water, 2=permanent water). Metadata with input parameters can be downloaded directly as a CSV file.<br><br>
									<b>NOTE:</b> Due to limitations with the current implementation of the download option, there is a constraint on the size of the area that can be downloaded.
									You will see a warning if the area you have selected or drawn is too big. Near the limit there is a possibility that you receive a corrupted zip file. In that case,
									simply delete it and retry the download. We are working on a better implementation of the download option, which will remove all area constraints and other issues.
									</span>
								</div>
								<!-- toggle the export info panel -->
								<script>
								$(".export-info-button").click(function () {
									$(".export-info").toggleClass("export-info-shown");
								});
								</script>
							</div>
						</div>
					</div>


					<div class="attr-show-button">&#171;</div>
					<script>
					$(document).ready(function(){
						$(".attr-show-button").click(function () {
							$(".attributions").show();
							$(".attr-show-button").hide();
							$(".attr-collapse-button").show();
						});
					});
					</script>

					<!-- Block with relevant organisation/company logo and link to websites -->
					<div class="attributions">
						<hr/>
						<a href="https://www.usaid.gov/" target="_blank"><img border="0" src="static/images/usaid.png" style="height: 40px"></a>
						<a href="https://www.nasa.gov/" target="_blank"><img border="0" src="static/images/nasa.png" style="height: 40px; margin-left:30px"></a>
						<a href="http://www.adpc.net/" target="_blank"><img border="0" src="static/images/adpclogo.jpg" style="height:40px; margin-left:30px"></a>
						<a href="https://www.deltares.nl/en/" target="_blank"><img border="0" src="static/images/deltares_tr.png" style="height:36px; margin-left:5px"></a>
						<a href="http://http://sig-gis.com/" target="_blank"><img border="0" src="static/images/sig_tr.png" style="height: 40px; margin-top:10px; margin-left:35px"></a>
						<a href="https://www.sei-international.org/asia" target="_blank"><img border="0" src="static/images/sei_tr.png" style="height: 40px; margin-top:10px; margin-left:50px"></a>
						<!--<a href="https://earthengine.google.com/" target="_blank"><img border="0" src="static/images/googlelogo_color_272x92dp.png" style="height:34px; margin-left:15px"></a>-->
						<a href="https://earthengine.google.com/" target="_blank"><img border="0" src="static/images/google_earthengine_powered_400px.png" style="height:40px; margin-top:10px; margin-left:100px"></a>
						<div class="attr-collapse-button">&#171;</div>
						<script>
						$(document).ready(function(){
							$(".attr-collapse-button").click(function () {
								$(".attributions").hide();
								$(".attr-show-button").show();
								$(".attr-collapse-button").hide();
							});
						});
						</script>
					</div>
				</div>

				<!-- scrollbar for entire panel -->
				<script>
				$(document).ready(function() {
					$(".panel").css("max-height", ($(document).height()-parseInt($(".ui").css('top'), 10))-20);
				});
				</script>

			</div>

			<!-- Warning messages placeholder -->
			<div class="warnings">
				<span></span>
			</div>

			<!-- Download link(s) panel -->
			<div class="download_panel">
				<div id="download_prep">
					<span>Preparing download link(s)...</span>
				</div>
				<a id="link1" target="_blank">Click here to download water layer</a>
				<a id="link2" target="_blank">Click here to download water layer (2)</a>
				<a id="link3" target="_blank">Click here to download water layer (3)</a>
				<a id="link4" target="_blank">Click here to download water layer (4)</a>
				<a id="link_metadata" target="_blank">Click here to download metadata</a>
			</div>

		</div>

		<div id="chartModal" class="modal display-none-imp">

			<!-- Modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<span class="modal-close">&times;</span>
				</div>
				<div class="modal-body"></div>
			</div>

		</div>

		<!-- Google Analytics -->
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-101791952-1', 'auto');
		  ga('send', 'pageview');

		</script>


		<!-- Boot application once the body loads. -->
		<script>
			// Here we get the mapid and token for the map tiles that were generated by Earth Engine using the Python script server.py and injected using the Jinja2 templating engine.
			water.boot('{{ eeMapId | safe }}','{{ eeToken | safe }}',);
		</script>

	</body>
</html>
